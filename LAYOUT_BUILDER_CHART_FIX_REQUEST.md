# Layout Builder Chart Rendering Fix Request

**Date**: 2025-01-15
**From**: Analytics Microservice Team
**To**: Layout Builder Team
**Priority**: HIGH
**Presentation ID**: 8d4dce55-517c-4dad-9577-47152ff647d0

---

## Problem Statement

ApexCharts are not rendering in L02 layout despite:
- ✅ No JavaScript console errors
- ✅ Correct chart HTML generation by Analytics Microservice
- ✅ Correct JavaScript escaping in server.py (lines 199-216)
- ✅ ApexCharts library loading successfully
- ✅ Chart initialization executing without errors

**Issue**: Charts are invisible due to CSS `overflow: hidden` clipping.

---

## Root Cause

**File**: `src/styles/core/borders.css` (lines 11-18)

```css
/* ===== Base Element Styles ===== */
.reveal .slides section > * {
  box-sizing: border-box;
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
  align-items: flex-start;
  overflow: hidden;  /* ⚠️ THIS BLOCKS CHART RENDERING */
}
```

This CSS rule applies to ALL direct children of slides, including the `.diagram-container` in L02 where ApexCharts should render.

**Impact**:
- The chart `<div>` is set to `width: 100%; height: 720px`
- ApexCharts renders the SVG inside this div
- Parent container's `overflow: hidden` clips the chart from view
- `display: flex` may also interfere with ApexCharts positioning

---

## Fix Options

### Option 1: Modify L02.js Inline Styles (RECOMMENDED)

**File**: `src/renderers/L02.js`
**Line**: 20

**Change FROM**:
```javascript
<div class="diagram-container" style="grid-row: 5/17; grid-column: 2/23;">
  ${content.element_3 || ''}
</div>
```

**Change TO**:
```javascript
<div class="diagram-container" style="grid-row: 5/17; grid-column: 2/23; overflow: visible; display: block; height: 100%;">
  ${content.element_3 || ''}
</div>
```

**Why Recommended**:
- Minimal impact (only affects L02 layout)
- Doesn't change global CSS
- Specific to chart/diagram rendering needs
- Easy to test and verify

---

### Option 2: Add CSS Exception

**File**: `src/styles/core/borders.css`
**Location**: After line 18

**Add**:
```css
/* Exception for diagram containers - allow chart rendering */
.diagram-container {
  overflow: visible !important;
  display: block !important;
  height: 100%;
}
```

**Why Alternative**:
- Broader fix affecting all layouts
- May impact other layouts using `.diagram-container`
- Requires more comprehensive testing

---

## Verification Steps

After applying the fix:

1. **Open test presentation**: https://web-production-f0d13.up.railway.app/p/8d4dce55-517c-4dad-9577-47152ff647d0

2. **Check Slide 2 (Line Chart)**:
   - Chart should be visible with smooth line curve
   - Hover tooltips should show revenue values
   - Markers should be visible on data points

3. **Check Slide 3 (Bar Chart)**:
   - Vertical bars should be visible
   - Data labels should appear above bars (e.g., "$450K")
   - Bars should have rounded corners

4. **Check Slide 4 (Donut Chart)**:
   - Donut chart should be visible with three segments
   - Legend should show below chart (Enterprise, SMB, Startup)
   - Center total should be displayed
   - Percentage labels should appear on segments

5. **Browser Console**: Should remain error-free

6. **Inspect Element**:
   - Open DevTools on a chart slide
   - Inspect `.diagram-container`
   - Verify `overflow: visible` is applied
   - Verify chart SVG is rendered inside

---

## Technical Details

### Chart HTML Structure (Generated by Analytics)
```html
<div id="chart-xxxxxxxx" style="width: 100%; height: 720px;"></div>
<script src="https://cdn.jsdelivr.net/npm/apexcharts@3.45.0/dist/apexcharts.min.js"></script>
<script>
(function() {
  const options = { /* ApexCharts config */ };
  const chart = new ApexCharts(document.querySelector('#chart-xxxxxxxx'), options);

  // Reveal.js integration
  if (typeof Reveal !== 'undefined') {
    Reveal.on('slidechanged', function(event) {
      // Render chart when slide becomes active
    });
  }
})();
</script>
```

### Current L02 Rendering
```javascript
// src/renderers/L02.js
element_1: Subtitle (grid-row: 2/5)
element_2: Main content/narrative (grid-row: 5/17, grid-column: 24/32)
element_3: Chart/diagram (grid-row: 5/17, grid-column: 2/23) ← PROBLEM HERE
```

---

## Impact Assessment

### After Fix:
- ✅ ApexCharts will render correctly in L02 layout
- ✅ Interactive features (hover, tooltips) will work
- ✅ Charts will animate on slide appearance
- ✅ All existing functionality preserved
- ✅ No breaking changes to other layouts (if using Option 1)

### Testing Scope:
- **Critical**: L02 layout with chart content (element_3)
- **Regression**: Verify L01, L03, L25, L27, L29 layouts still work
- **Chart Types**: Test line, bar, and donut charts

---

## Timeline Request

**Target**: Deploy fix within 24 hours

**Reason**: Analytics integration is currently non-functional for chart rendering, blocking user deliverables.

---

## Contact

For questions or clarifications:
- **Analytics Team**: Available for testing and verification
- **Test Presentation**: https://web-production-f0d13.up.railway.app/p/8d4dce55-517c-4dad-9577-47152ff647d0
- **Generated Chart Data**: `/Users/pk1980/Documents/Software/deckster-backend/deckster-w-content-strategist/agents/analytics_microservice_v3/showcase_slides_data.json`

---

## Summary

| Component | Status | Action Required |
|-----------|--------|----------------|
| Analytics Microservice | ✅ Working | None |
| Server JavaScript Escaping | ✅ Working | None |
| L02 Renderer | ⚠️ Needs Fix | Add `overflow: visible; display: block;` |
| CSS Styles | ⚠️ Needs Fix | Override base styles for diagrams |

**Recommended Action**: Implement **Option 1** (modify L02.js inline styles) for minimal impact and quickest deployment.
